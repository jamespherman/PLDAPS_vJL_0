% Script for making files used by DKL-to-RGB color space conversion
% function. This script assumes that the 3 X 256 X 3 "colorData" array
% generated by "i1CalibrateAndMeasure.m" is being used as input.

clear
close all

% load "colorData"
dataDir = '/home/jph/Documents/PLDAPS_vJL_0/output/';
dataFile = '20240308_t1526_human_psychophysical_threshold_x1Data.mat';
load([dataDir dataFile]);

% get maximum and minimum luminance values for each "gun":
maxLum = squeeze(max(colorData(1,:,:)));
minLum = squeeze(min(colorData(1,:,:)));

% make vectors of 256 linearly spaced luminance intensities between minimum
% and maximum:
nSteps = 256;
lumInts = [
    linspace(minLum(1), maxLum(1), nSteps)', ...
    linspace(minLum(2), maxLum(2), nSteps)', ...
    linspace(minLum(3), maxLum(3), nSteps)];

% make data holder for "look up" curves:
luts = zeros(nSteps, 3);

% loop over intensities to construct "look up" curves:
for i = 1:nSteps
    
    % loop over guns:
    for j = 1:3

        % find smallest value that acheives desired luminance intensity
        luts(i, j) = find(colorData(1,:,j) <= lumInts(i, j), 1, 'first');
    end
end