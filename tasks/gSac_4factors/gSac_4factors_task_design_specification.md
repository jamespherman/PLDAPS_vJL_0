# gSac_4factors Task Design Specification

## 1. Task Overview

The **gSac_4factors** task is a memory-guided saccade paradigm designed to study how four experimental factors influence saccadic eye movements. On each trial, the subject fixates a central point, observes a briefly flashed peripheral target, maintains fixation through a memory delay, and then makes a saccade to the remembered target location upon receiving a go signal (fixation point offset).

This task manipulates four orthogonal factors:
1. **Stimulus Type / Salience** (face, non-face, high-salience bullseye, low-salience bullseye)
2. **Reward Magnitude** (high vs. low)
3. **Target Probability** (high-probability vs. low-probability location)
4. **Target Location** (4 positions arranged in quadrants)

---

## 2. Experimental Factors

### 2.1 Stimulus Type / Salience

Six stimulus conditions are used, combining stimulus category with salience level:

| Stim Type Code | Description | Salience | Target Color |
|----------------|-------------|----------|--------------|
| 1 | Face (monkey face image) | N/A (image) | N/A |
| 2 | Non-Face (object image) | N/A (image) | N/A |
| 3 | Bullseye - High Salience, Hue A | High | 0 deg DKL |
| 4 | Bullseye - Low Salience, Hue A | Low | 0 deg DKL |
| 5 | Bullseye - High Salience, Hue B | High | 180 deg DKL |
| 6 | Bullseye - Low Salience, Hue B | Low | 180 deg DKL |

**Salience Manipulation (Bullseye only):**
- **High Salience**: Target hue is 180 degrees opposite to background hue in DKL color space
- **Low Salience**: Target hue is 45 degrees offset from background hue in DKL color space

### 2.2 Reward Magnitude

Two reward levels are used:
- **High Reward**: 350 ms solenoid open duration (default)
- **Low Reward**: 160 ms solenoid open duration (default)

Reward level is determined by target location hemifield and half-block position (see Block Structure).

### 2.3 Target Probability

Target probability is manipulated across blocks:
- **High-Probability Location**: 5 repetitions per half-block (10 per block)
- **Low-Probability Locations**: 1 repetition per half-block (2 per block)

In Block 1, Location 1 is the high-probability location.
In Block 2, Location 3 is the high-probability location.

### 2.4 Target Location

Four target locations are generated by rotating a base position (default: 17 deg X, 3 deg Y) in 90-degree increments. The locations are organized into two hemifields:
- **Hemifield A**: Locations 1 and 2
- **Hemifield B**: Locations 3 and 4

---

## 3. Stimuli

### 3.1 Fixation Point

- **Shape**: Square frame (outline rectangle)
- **Size**: 16 pixel radius, 6 pixel line width
- **Color**: Black (visible to subject)
- **Position**: Screen center (configurable via `fixDegX`, `fixDegY`)

### 3.2 Target Stimuli

#### 3.2.1 Face Images (Stim Type 1)
- **Source**: 15 monkey face images from stimulus file
- **Format**: Grayscale images with shape mask
- **Size**: 6 degrees visual angle (square)
- **Background**: Transparent (matches screen background)

#### 3.2.2 Non-Face Images (Stim Type 2)
- **Source**: 120 non-face object images from stimulus file
- **Format**: Grayscale images with shape mask
- **Size**: 6 degrees visual angle (square)
- **Background**: Transparent (matches screen background)

#### 3.2.3 Bullseye Patterns (Stim Types 3-6)
- **Shape**: Two concentric rectangular frames (rings)
- **Outer ring**: 4 degrees visual angle
- **Inner ring**: 2 degrees visual angle
- **Line width**: 12 pixels
- **Color**: DKL hue (0 deg or 180 deg depending on condition)

### 3.3 Background Colors

Background color depends on stimulus type:

| Stim Type | Background Color |
|-----------|-----------------|
| 1-2 (Images) | Isoluminant grey (DKL: L=-0.495, chrom=0) |
| 3 (High Sal, Hue A) | DKL 180 deg hue |
| 4 (Low Sal, Hue A) | DKL 45 deg hue |
| 5 (High Sal, Hue B) | DKL 0 deg hue |
| 6 (Low Sal, Hue B) | DKL 225 deg hue |

**DKL Color Space Parameters:**
- Mean luminance: -0.495 (relative units)
- Saturation radius: 0.4
- Hues used: 0, 45, 180, 225 degrees

---

## 4. Spatial Configuration

### 4.1 Target Locations

Target locations are computed by rotating a base position in 90-degree increments:

```
Base position: (targDegX_base, targDegY_base) = (17, 3) degrees

Location generation:
  1. Convert base to polar: (theta, r) = cart2pol(17, 3)
  2. Generate 4 locations by rotating theta by 0, 90, 180, 270 degrees
  3. Convert back to Cartesian for each location
```

For default base position (17, 3):
- **Location 1**: Approximately (17, 3) deg - upper right quadrant
- **Location 2**: Rotated 90 deg from Location 1
- **Location 3**: Rotated 180 deg from Location 1 (lower left quadrant)
- **Location 4**: Rotated 270 deg from Location 1

### 4.2 Hemifield Organization

Locations are grouped into hemifields for reward manipulation:
- **Hemifield A**: Locations 1 and 2
- **Hemifield B**: Locations 3 and 4

### 4.3 Window Sizes

| Window | Width | Height | Default (deg) |
|--------|-------|--------|---------------|
| Fixation | fixWinWidthDeg | fixWinHeightDeg | 2 x 2 |
| Target | targWinWidthDeg | targWinHeightDeg | 8 x 8 |

---

## 5. Temporal Structure (Trial Timeline)

Each trial proceeds through the following phases:

```
Trial Timeline:
================================================================================

1. JOYSTICK WAIT         |----[up to 15s]---->|
   (State: waitForJoy)   Subject presses joystick to initiate trial

2. FIXATION ACQUISITION  |----[up to 3s]----->|
   (State: showFix)      Fixation point appears; subject acquires fixation

3. PRE-TARGET FIXATION   |----[0.75-1.0s]---->|
   (State: dontMove)     Fixation maintained; target onset pending

4. TARGET FLASH          |----[0.4s]--------->|
   (State: dontMove)     Target appears briefly

5. MEMORY DELAY          |---[variable]------>|
   (State: dontMove)     Target off; fixation maintained until go signal
                         Total time from target onset to go: 0.3-0.8s

6. SACCADE EXECUTION     |----[0.1-1.0s]----->|
   (State: makeSaccade)  Fixation offset (go signal); subject makes saccade

7. TARGET HOLD           |----[0.2-0.3s]----->|
   (State: holdTarg)     Gaze maintained on target location

8. REWARD DELIVERY       |----[variable]----->|
   (State: sacComplete)  Juice reward + post-reward period (0.25s)

================================================================================
```

### 5.1 Timing Parameters (Defaults)

| Parameter | Value | Description |
|-----------|-------|-------------|
| joyWaitDur | 15 s | Max time to wait for joystick press |
| fixWaitDur | 3 s | Max time to acquire fixation after joystick press |
| targOnsetMin | 0.75 s | Minimum time from fixation to target onset |
| targOnsetMax | 1.0 s | Maximum time from fixation to target onset |
| targetFlashDuration | 0.4 s | Duration target is visible |
| goTimePostTargMin | 0.3 s | Min time from target onset to go signal |
| goTimePostTargMax | 0.8 s | Max time from target onset to go signal |
| goLatencyMin | 0.1 s | Minimum saccade latency (earlier = fixation break) |
| goLatencyMax | 1.0 s | Maximum saccade latency (later = fixation break) |
| maxSacDurationToAccept | 0.1 s | Max saccade flight duration |
| targHoldDurationMin | 0.2 s | Min target hold duration |
| targHoldDurationMax | 0.3 s | Max target hold duration |
| rewardDelay | 0.25 s | Delay between target hold and reward |
| postRewardDuration | 0.25 s | Post-reward recording period |
| timeoutdur | 0.275 s | Timeout after error trials |

---

## 6. Block and Half-Block Structure

### 6.1 Structure Overview

The experiment uses a nested block design:
- **2 Blocks** (different probability locations)
- **2 Half-Blocks per Block** (different reward hemifields)
- **Total: 4 Half-Blocks**

### 6.2 Probability Manipulation (By Block)

| Block | High-Probability Location | Low-Probability Locations |
|-------|--------------------------|---------------------------|
| 1 | Location 1 (5 reps/half-block) | Locations 2, 3, 4 (1 rep each) |
| 2 | Location 3 (5 reps/half-block) | Locations 1, 2, 4 (1 rep each) |

### 6.3 Reward Manipulation (By Half-Block and Hemifield)

| Half-Block | Block | Hemifield A (Loc 1-2) | Hemifield B (Loc 3-4) |
|------------|-------|----------------------|----------------------|
| 1 | 1 | High Reward | Low Reward |
| 2 | 1 | Low Reward | High Reward |
| 3 | 2 | High Reward | Low Reward |
| 4 | 2 | Low Reward | High Reward |

### 6.4 Trials Per Half-Block

Each half-block contains trials for all 4 locations and all 6 stimulus types:

| Location Type | Reps per Stim Type | Total per Half-Block |
|--------------|-------------------|---------------------|
| High-Prob Location | 5 | 5 x 6 = 30 trials |
| Low-Prob Location (x3) | 1 each | 3 x 6 = 18 trials |
| **Total per Half-Block** | | **48 trials** |

**Total trials per complete experiment cycle:**
- 4 half-blocks x 48 trials = **192 trials**

---

## 7. Trial Types Summary

### 7.1 Complete Condition Enumeration

For each half-block, the following conditions are presented:

| Location | Stim Type | Salience | Reward | Reps |
|----------|-----------|----------|--------|------|
| High-Prob | Face | - | varies | 5 |
| High-Prob | Non-Face | - | varies | 5 |
| High-Prob | Bullseye | High | varies | 5 |
| High-Prob | Bullseye | Low | varies | 5 |
| Low-Prob (x3) | Face | - | varies | 1 |
| Low-Prob (x3) | Non-Face | - | varies | 1 |
| Low-Prob (x3) | Bullseye | High | varies | 1 |
| Low-Prob (x3) | Bullseye | Low | varies | 1 |

### 7.2 Trial Selection

Within each half-block, trials are shuffled randomly. Trials are drawn sequentially from each half-block pool (half-block 1 depleted before half-block 2 begins, etc.). After all 4 half-blocks are complete, the cycle resets.

---

## 8. Behavioral Requirements

### 8.1 Joystick

- Subject must press and hold joystick throughout the trial
- Joystick release at any point before reward = **joyBreak** (trial aborted)

### 8.2 Eye Position

| Phase | Requirement | Failure Condition |
|-------|-------------|-------------------|
| Fixation acquisition | Enter fixation window within fixWaitDur | **nonStart** |
| Pre-target fixation | Maintain fixation in window | **fixBreak** |
| Memory delay | Maintain fixation in window | **fixBreak** |
| Post-go (before saccade) | Exit fixation window within latency constraints | **fixBreak** (too early or too late) |
| Target hold | Enter and maintain target window | **fixBreak** |

### 8.3 Saccade Requirements

- Saccade must be initiated within latency window (0.1 - 1.0 s after go signal)
- Eye velocity must exceed threshold (100 deg/s) to detect saccade onset
- Saccade must land within target window
- No blinks during saccade (gaze position > 35 deg = blink artifact)

---

## 9. Trial Outcomes

| Outcome | Code | Description |
|---------|------|-------------|
| sacComplete | 21 | Successful trial - reward delivered |
| fixBreak | 31 | Eye left fixation/target window prematurely |
| joyBreak | 32 | Joystick released before reward |
| nonStart | 33 | Failed to acquire fixation in time |
| failedToHoldTarg | 34 | Did not maintain target fixation |

---

## 10. Visual Display Details

### 10.1 Dual-Display System

The task uses a VIEWPixx display with separate color lookup tables (CLUTs) for:
- **Subject display**: Shows only task-relevant stimuli
- **Experimenter display**: Shows additional overlays (windows, gaze position, grid)

### 10.2 Experimenter-Only Elements

| Element | Description |
|---------|-------------|
| Fixation window | Grey rectangle around fixation point |
| Target window | Grey rectangle around target location |
| Eye position | Blue square tracking current gaze |
| Grid lines | Grey lines at 2-degree intervals |
| High-reward indicator | Green rectangle around target (when high reward) |

---

## 11. Data Recorded

### 11.1 Timing Events (Strobed)

- Trial begin
- Joystick press
- Fixation onset/acquisition/offset
- Target onset/offset/reillumination
- Saccade onset/offset
- Target acquisition
- Reward delivery
- Trial end

### 11.2 Saccade Metrics (Computed Post-Trial)

- Pre-saccade position (X, Y)
- Post-saccade position (X, Y)
- Peak velocity (deg/s)
- Saccade reaction time (SRT)

---

## 12. Key Experimental Design Features

1. **Memory-guided saccades**: Target flashes briefly and disappears before go signal, requiring spatial memory.

2. **Factorial design**: Four factors (stimulus type/salience, reward, probability, location) are fully crossed within the block structure.

3. **Within-session reward manipulation**: Reward magnitude alternates between hemifields across half-blocks, allowing within-session comparison.

4. **Probability asymmetry**: High-probability location receives 5x more trials than low-probability locations, creating different prior expectations.

5. **Controlled salience**: Bullseye conditions use DKL color space to independently manipulate chromatic contrast while maintaining isoluminance.

6. **Categorical stimulus comparison**: Face vs. non-face images allow comparison of stimulus category effects.
